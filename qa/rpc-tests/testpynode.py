#!/usr/bin/env python3
# Copyright (c) 2015-2018 The Bitcoin Unlimited developers
# Distributed under the MIT software license, see the accompanying
# file COPYING or http://www.opensource.org/licenses/mit-license.php.
import test_framework.loginit
# This is a template to make creating new QA tests easy.
# You can also use this template to quickly start and connect a few regtest nodes.

import time
import sys
if sys.version_info[0] < 3:
    raise "Use Python 3"
import logging

from test_framework.test_framework import BitcoinTestFramework
from test_framework.util import *
from test_framework.mininode import *

class MyTest (BitcoinTestFramework):

    def setup_chain(self,bitcoinConfDict=None, wallets=None):
        print("Initializing test directory "+self.options.tmpdir)
        # pick this one to start from the cached 4 node 100 blocks mined configuration
        initialize_chain(self.options.tmpdir, bitcoinConfDict, wallets)
        # pick this one to start at 0 mined blocks
        # initialize_chain_clean(self.options.tmpdir, 1, bitcoinConfDict, wallets)
        # Number of nodes to initialize ----------> ^

    def setup_network(self, split=False):
        self.nodes = start_nodes(1, self.options.tmpdir)
        # Nodes to start --------^
        # Note for this template I readied 4 nodes but only started 2

        # Now interconnect the nodes
        connect_nodes_full(self.nodes)
        # Let the framework know if the network is fully connected.
        # If not, the framework assumes this partition: (0,1) and (2,3)
        # For more complex partitions, you can't use the self.sync* member functions
        self.is_network_split=False
        self.sync_blocks()

    def run_test (self):
        # this transaction can be regenerated by the C code in transaction_tests.cpp
        t = "".join([
'00fd0001007ea2786cca220e4f42a867ec1e3b480d33e1f9d2faa8ff3a63d6468664803fa800ffffffff6400000000000000003603de84f6e6b121dba4f937b56c72c88777826f98c78093',
'3f83c1b411602d1600ffffffff6400000000000000001bbb1bb96b524758e965aa96c2d1081bb45d8600fe59732f9f436e64309fa43400ffffffff640000000000000000b6498dcb698447',
'89437d7450ac84aef8b60b204be0d4484f455daec5a9efcfa600ffffffff64000000000000000020fa89d91e8523ddb15183f915eaaba568273c718b5cf8bd2b651292cd0bea1a00ffffff',
'ff64000000000000000053f2b6220c5eafeb4b29f6b48d4398cc8c46b3bb279f927876f79e0a8d71904400ffffffff640000000000000000967b3a8a0f906f53084ad26bdabe56f86d5048',
'81b5ad69801296c5d4d22732b200ffffffff640000000000000000a83b427ec1cf2efd4ce0c2fa5b5d7a92487d392f01b1618c755cf39d393764db00ffffffff6400000000000000008ec1',
'466c657c3fe93c38881a80c4dc33d6c80cc8871e4c3701d61dbf0b447d8300ffffffff6400000000000000007c760e1ebd20ae2234a48f0c7b8afa811f3576745c6444dd092bb25928adc6',
'3a00ffffffff64000000000000000036672b516adbcc78a4084307818657762f3f6cac5043e9d27eab12e0c447841700ffffffff64000000000000000034c16593bc5299260e49d3837817',
'770b12f759c5bfd7539a9e881bcb91cdeb7300ffffffff640000000000000000d359b5fc43d3b190d1d40c7bf42fcee2ab249ccc158f29c8adfe1a5eab266f9d00ffffffff640000000000',
'00000036aa0029c94621b79c1d01f818d7e83d67c3663ec6bd8bae9bce29730416a1c800ffffffff640000000000000000086495843542a0d373b3d59468e8ff182c16bdf2596ec6c30fc4',
'5788e4759aea00ffffffff640000000000000000c08a92ba4c2d218020fd26a4c9d9c39715a63c6cf9e3c13b87520d2b53fac5bd00ffffffff640000000000000000b07c7d75097aacf196',
'2f7fdc3a82fe0f9acd7a8aaf8ce362db0912a554e72c6300ffffffff640000000000000000d0ca55d13a19acafd0becfb997aad5e2ad5b539899fa341a86833fed6255a00000ffffffff64',
'0000000000000000312c609551038ac4a6f4ff8ff12f90cc9e824025bce5c2a82b8318616c0d0fbd00ffffffff640000000000000000d173435306d35dd63ce8205a6fc04164d3bcbf8db6',
'0f515208fd54f3990179a400ffffffff640000000000000000c5d5f46c33bf1e646aa1d67418378ad734ab24ea74a36c1c528ffd085edace2b00ffffffff64000000000000000094edfe94',
'204d117dbc00afa1e5546c7a5801387b0c1a5837015e45e95e0eaf4b00ffffffff640000000000000000a3c88918477433f23d7d3e827335acaee34dca8cec96edd4c513bc1418f8b87700',
'ffffffff6400000000000000000ff222f1bf72e2d960963ec815f44dbb1e5e99d40be00658ab0b6befb06ab2ce00ffffffff6400000000000000001702c765d301e9d2993ac6dd36718538',
'51f2fdf8074f6ae9110d2d22232ff79c00ffffffff64000000000000000049b2d5c8dcc9203da013c4f0a95d7729c53a1d342505f4609048b68489feb2dd00ffffffff6400000000000000',
'00c01884d71d38a24527b543427c0c73c0a67d4ffc3dff28442e45e9ee08ad030200ffffffff640000000000000000ab57e1477ff2e0b8166d58e78c8672896b4b5dac50d2499095ca2870',
'154fbea600ffffffff6400000000000000004779556d43334b35c844cbf36632137302136cdbbcf5cec6428ac1b90a319f0000ffffffff6400000000000000008fc1d3341d5425681abe5b',
'03e2427f8aed9ffc5a749bcb4c007b439c8e9a853e00ffffffff64000000000000000054817c825471564c4d0412437748bdb083f0056764552b7bea003de755e33eab00ffffffff640000',
'0000000000008d16ff8e32737a5dea4c19c8f34f5d1252a095298b45fd8ef1f43e820b184fb300ffffffff640000000000000000eadf82e717fe6027757d31a3021fa091ac753bb0529eb3',
'0ad04d1a2faa89f46200ffffffff6400000000000000007209f5e86e5a96359d1f37c45a05080048b68d73b74214448607e82541b6692800ffffffff640000000000000000bc81a62232fc',
'4f137dcd4aaae46712b2d3146b1603ed5a46702098af312cd90700ffffffff6400000000000000001b06f873c15f40cea69e7497875bb6767128f103e73bedb19c101bb349e6865800ffff',
'ffff6400000000000000000c20e84ffa6d8e857c443443402a1e48dfb284346eeef4a449d5c6b2804643ea00ffffffff6400000000000000009a7a008e0dfe255fc80c47963ff1937095db',
'48df2a6f534825e17f62d8ac44ca00ffffffff6400000000000000007b65a040ec3b0b435b694414871d607d5229bc156169e0927a2745ff508c22ba00ffffffff64000000000000000012',
'd6f36a57289db3e0b393fef6fd683bbb64a68778bec4f9bef004d91967ffbe00ffffffff6400000000000000002eeda5b517c5f70d972ec04d8331ea514571a7cdca37c4144a8e5dcca46d',
'27e100ffffffff6400000000000000001dfc36d8766954732d39e52c5d12eed3dac71549acf78d1f3f4861f51909aaaa00ffffffff640000000000000000c743bfc3ef5974cf2f8a184dc0',
'7e353c2c5f6b6fb03c623a035f42bc3128169b00ffffffff64000000000000000026f6feb86624032c4d7532aced55f06cbed971f311431eae682008e773e8767600ffffffff6400000000',
'00000000e22642b86ba096de92f023ecc425cc271cf3633a496fa1366498072a023e656e00ffffffff6400000000000000006878d7060c8c1f0b2ceea33a4af41f7d34364661ee16e3ea5b',
'46691fa6ce39ae00ffffffff640000000000000000a3429b02d03e33c71d2d1add1fa212bef02ff3ae5ccdd3d68f0383268c65e18e00ffffffff64000000000000000047d60e767d99bfdd',
'e53c76a58430d25e55f899cf5dd5150aaefb1aa756c4d8a600ffffffff6400000000000000009ddb3122658ca59c30a9e0fe37261da5077fcbb497e60a01a3ee91fbfd5db6b600ffffffff',
'640000000000000000d21eafffbbc323862ffbf4b2c697c840667cbc538c56e219ff2fd4191cdd2f8100ffffffff640000000000000000a43507a35886daa079a9015a4f255117a8a9322b',
'747aee4248a51625aed3bdbc00ffffffff6400000000000000001af41d105d2d1633f61f2f71dd502a7aa368781e26ed5d1ee804156decb311f800ffffffff640000000000000000e4a6fc',
'cb8f3cb9af431a58cc5b199064bc7aa20d543db57eb04470342f14962300ffffffff6400000000000000006a1cd5d2f3eccdefe695b313af20c38dc2e8e571b2baa8a8a2b2984963265e9b',
'00ffffffff640000000000000000ed587c2a7fdae3da9c0b006e01970290956b77320015e03ad0d60edd304fdec400ffffffff64000000000000000055f0024872fc8561de35937f81daf9',
'cb859af917b6c9e86b73e59018ad02128200ffffffff6400000000000000007bfa596d5075ead3e9a2047bde416cc7b2eafe160dae15dd2d6dc95b374dc34600ffffffff64000000000000',
'00006d15d49862e64fe034cb1c5ba832943266ad4671ec3baad18aa07c4819a6efbf00ffffffff6400000000000000002871f9bf0eb24ffba81548fbdd15948bc13992a3c49bd49212af2b',
'43cd63133200ffffffff6400000000000000006a83263f629a13fe4b09fe4459c4fb325aa1ef3cdb6dc68f6df5ffe33f891f3100ffffffff640000000000000000ea81aa450ad008fe7d35',
'489f3230bd6beb81405139f23437e32830476f6f406700ffffffff6400000000000000009c661aecf0fd329016fc47f9ff011bb20d4c035a3f73acb4d118fb3671071e2500ffffffff6400',
'00000000000000bab880806eb8047171ec8c335fef11db153f8ef832fb122b8f7edbff479de68b00ffffffff640000000000000000c1b258ca12aaed15694a3de48effe5a686cf6068f06e',
'4b4a67a027ad9f9ed8d000ffffffff64000000000000000050f58a52b61dfa57179ea78a8e1b5a58a0aa8361abffb556d4cb58665f92ebb100ffffffff640000000000000000cd9a7cbdbd',
'2dba38398ea9f8d3d06dc340fa0f4691751f3369eacaa64d14d5b800ffffffff640000000000000000bf02f9b868c14b89ada9d9d047af672ac741c6ecf21eea87df14eaea51e6a42d00ff',
'ffffff640000000000000000d7322c86bfa2129b419324b92716678940377541ca62159e8204a3cb1c4d2fb500ffffffff64000000000000000080d2558cc99eff4f10ea63544035be9fc9',
'd56567ce2d3d4cfced9d590610537400ffffffff6400000000000000005400097443bdcdd863fcab26f56618628c96df53ed08ae484cc3347c3ce0676700ffffffff640000000000000000',
'fa7f2d17bc63b14e07fd0233569604ec1db7d583c566b4a82d17e72f412b4db100ffffffff6400000000000000005b9480e624f361a3a760f9ac4bbe83363eb52326648db94d23d80c5774',
'75618c00ffffffff64000000000000000048ceece649e384d36ceaa86e8a9db91866e2d77833d128a20cb9f6d11364585200ffffffff640000000000000000aa77d38c0a7c8efaea7f2b59',
'b08e45a63f98cbb3f6caad87509fa9a73f2c8f7e00ffffffff640000000000000000a1106c5ba243849c53a12b9ffe578d1f0fe505fa5e926a623cf689985017e3d200ffffffff64000000',
'0000000000cf1ed2659fc65f5369814fa5701321877b097675e8d9b47721924093b65cb5bd00ffffffff6400000000000000005860efabc3f7a3e39f8784b71d05aa6afd5deca629bd1512',
'f90e585117f9ca7400ffffffff6400000000000000006be92c712a37d0c0d160613e11a5e4a3613e693f29a59e0ab7de4741c7bd459100ffffffff64000000000000000069e994675cb385',
'f7653d8458951bf3538592ecca3da6f9dddfb115403c9a0f2400ffffffff64000000000000000097a14b68135aa3541eb492e7198cb523a89e24ae1812cb40e4f7c7ca2952446900ffffff',
'ff64000000000000000016017600f68a648b327be783dd889cffb65da0a7ae0d46ce4ae05fa787ccbbfa00ffffffff6400000000000000009fb0832900e8a11d8c307a958d8abc8c831a71',
'162ccbddf9df8f0d66d710a2c200ffffffff64000000000000000023de178a496394b4cb1468dafddb70b401cab20304d3013e6637d6cd19101f9700ffffffff640000000000000000e7e1',
'f9c80a03df808d486b1d10be78fc62a903bb08504a851dfeb844115f1b3600ffffffff640000000000000000b485383f5c5ddcc9b7714eef71db8779685cdeee5c06ee12d0eeaa5a50127d',
'c300ffffffff64000000000000000068e4951590c7b4c9c86e0e3bb73c23a369b2c64e442ffd9ecae0262e262d504600ffffffff640000000000000000e8d8956e191ddcd37a959d6250a9',
'a701e4c45b070bb6a144d8230440ce470cba00ffffffff640000000000000000553b8c0941604a9229023954a3601e4543301fbb17714844bbe3d1ea4cc13fb700ffffffff640000000000',
'00000088cd260ca17ea10377ccb42a19b41214f4ffab5b09337ef14bf41f5cbfda3f3800ffffffff640000000000000000bbe4dae12d5337fd740b6dcb3d111b0bf392f28a24b7bec5a5c2',
'88df9f4d5b5d00ffffffff640000000000000000ec592cacfcbbb51b1de7e36f4ca31a44777d886e07bfec8d49d84eb34650988200ffffffff640000000000000000b51c86cc45a070f9c2',
'97275f3f0729c9f51d1a11e744e11fca77041f45c5b5a900ffffffff6400000000000000004c6e874386414c9236e17345e20641808dbaaca795e673356f047959914ca5f900ffffffff64',
'00000000000000007f0b51f83b8a68a6197a2f222d3f556b37dccc4d22cc6d08812274a0a706988000ffffffff6400000000000000002baa268acd37ffe2660f5bbd64e03f4f559e22ab10',
'c55391f67e1a74e3c6394100ffffffff64000000000000000085f65bd445bae66459cc8b2f974cea0d01d77a4525bf2f7a8c48fd11f1ab9ce200ffffffff6400000000000000000bd67141',
'ce626f599886445973cd1c637c28dfad8adbaae7c9c0bd0ca948f2f100ffffffff64000000000000000086c235f21dfd2a7c5249ba9c096f47aefbc6cc1cc6ccf327a4b2a5d908578bfa00',
'ffffffff6400000000000000005d20b1919b8921a0839cb2690030841187234c0e35de2d82a302c82ec93dc10100ffffffff640000000000000000dbe8729380e65b697ce484c2c0ce5583',
'e310a28013852821534049212f0a9c9a00ffffffff640000000000000000493267d7a6e945325bd531525304f1ad17642e98ebc428f4a0d3f29851b9dbdd00ffffffff6400000000000000',
'00a96818a0af5753ba5464e605e31c929f33b9b48079ccb0195757247f0f2b57ad00ffffffff6400000000000000002235021b1853b0beba0004df27b479df975480c176a4ebeb668156a3',
'95ff6fa100ffffffff640000000000000000c49f4b03383016220b756ffc0f674dff80f5313046263e7117e4a0ef610d8eca00ffffffff640000000000000000e573e45c7a5802eac717a3',
'f9ba6516ebaf1aa4d040a8e0882624e5fc7c35027700ffffffff6400000000000000008944703717b631a9eccc8a3eee62aaf8aadd79527f1b127574698dd5ba534de400ffffffff640000',
'000000000000d20081b2a3451818d880d37bb0e260346211e40fc072d43ba470b9bb080297b600ffffffff640000000000000000466a642d0702a63533742f12f4e368c3f63ff965b8641a',
'100fea8093709fe22800ffffffff64000000000000000054043ec80552bd81810201edf7f50ba3d2f64372c62185ef952ca24f433a613000ffffffff640000000000000000b692f80e6c5d',
'3eb0094cfdf9a61b5ef5c6dd27a68905e93e43b52b0bd262fc1e00ffffffff640000000000000000a91d853339ea8a8922cff9108da7ed54290f659d96f7a6e598c9d5cfbf829b7500ffff',
'ffff640000000000000000b45a276b4051f07894cc750aff4dfbcb5116124e891885aa9c860c8cde01c8e200ffffffff64000000000000000083fce3b378f32303dcaa5061de8f497dcecb',
'cbf88a29c63f96a65bc2b41134bd00ffffffff640000000000000000831ff3e8cb9118eece2421dcbea805103d2a3ff4829f2182d8bf66d13ce855fc00ffffffff640000000000000000a6',
'4b16db58e9ddb900c8290844be24ecee4eac253d88f65ebd9e9ff3eda96cc800ffffffff640000000000000000b93b7fd197aede5d8b6d5a44a93228ffc66ceb8e1ac2c61d259ba4aabe89',
'92c500ffffffff640000000000000000cb98963b1ef19b08a1a0a03537742b45418a80720d552630af6cfe1dbcb250c800ffffffff64000000000000000099edc0f4d9427f70b67cad733a',
'dcd018e5ad0f1fedd25248ee7837dcec8310b200ffffffff6400000000000000000111c0a109439570551776f7ab26fb6916dee3123a5d5c3974cf68ad0727cf2e00ffffffff6400000000',
'0000000084a90483f69c8f05ca2289ff8add74a5893eaa7d14343c81a7094ad12e69c6ee00ffffffff6400000000000000003e8072dfa414ea409bb51b69adc37ae6264dfe9fbafac79181',
'42f25e6ee95f5e00ffffffff6400000000000000003aa25d349a147c3d70caddea7ad1b89d02260ea3a3b73941298d63d87e48785700ffffffff640000000000000000af803f854545bfb5',
'521cf0a97ccb167528448ee853d5cace3d7f047ba61b6f8d00ffffffff64000000000000000089db0ace8bb01c695dfb8d7778e0a25a8732f7eae349c897d969f8b4d80c462300ffffffff',
'6400000000000000000cfb97a0b678c4eeb189be1c41986803947f18153506d065debe606db4863f0000ffffffff6400000000000000007ca30945bbb90d5f846b44aebd6fad46c8ab8ea4',
'fe633f73453fe8b7e88883a700ffffffff64000000000000000009e01412827f93c7903fa47245eda05cf214a336043e70299dbeeaf1d6e81a2a00ffffffff6400000000000000000a9bd0',
'db52b048cc0aa56858e000bba0f01ddfdaf1db835d143226da30d59b1500ffffffff640000000000000000c5be510b0bf717c85f9fa5215a56734d5979e886caf8b20e3733827c0b71315d',
'00ffffffff6400000000000000004304a4e05f962f03620617c6cd078d1d33ee0dc1abdb50a99660152df0b8e58a00ffffffff6400000000000000001e9c48d19b3cf101ec86d1586c6240',
'56cb45f350a7e84cb489b3766d43d7453400ffffffff640000000000000000bab1f862d960f5e9c26a6190f0387e21b5c635d19571c7805180131f29da6f7900ffffffff64000000000000',
'000003aa66b66ccf4199815546fced8ea16db97b40431cce133c03cfa1bbc8570a7900ffffffff6400000000000000004e7dc0e3d31f56dad04d37156757eb55ad83e53a1d1fe38bf21d90',
'55c8cccb4800ffffffff640000000000000000f59c01fc0293a370bae475902cc1952139ef1f0f9ef3f9509028baabaf33139500ffffffff64000000000000000004d057428140ece6dc5c',
'6d426df88d94961371ca590003a77c29f793d12bea1300ffffffff64000000000000000087a550adcf819809e455d9efb8dc9c5982e7851f3fb26e6987c99aa814d839e800ffffffff6400',
'0000000000000073cf370a2e9fedadec1e240aa07d011cfd999c179b54ad7adb038a4827906b9c00ffffffff640000000000000000bfbed098296bbe5a3e609d4c451672ca73315b02e0dd',
'a5401b08e5d7d30eb99900ffffffff6400000000000000007a51b926da94ee32fc32baa862084014138686f861f35fc41e48fe210397105a00ffffffff6400000000000000007614b860b8',
'2fc4c51c55aaa203c517cd12ed9daa77e1b7528c5222a2556b66f300ffffffff640000000000000000b3ca5839beccfb12c350f8126b5bd1ecca3b537035b7b254fd57a82def4d72fc00ff',
'ffffff640000000000000000da10bfc1e388bbae974a3346029c54f4e2305d2f1dd5f9cfbfd2319e3afbb20000ffffffff6400000000000000003d2a95b155bcf983f0fbf2538444116389',
'4c2343530906d8cf73a91dd2c2379700ffffffff6400000000000000008652a510a7bbf17505a22c1b736c4cb5f20a97a4b84efbb8e71cd9f3cb21bd3c00ffffffff640000000000000000',
'92d63f2f36e2e62662e0a2c65e8a40d79173bd3a49010e2fd5bff78d15903c6500ffffffff6400000000000000005ca1b81cdd0296404811127659a37231f23765478e0fd0532cba156c13',
'e30ff200ffffffff6400000000000000007aa5bb405f81ccfe0f219a779222c458ce27672ecaa44caab4ae0179c1d6e5e300ffffffff6400000000000000003e94f85365c4457eaeee25dc',
'1943484d6d175b8644ba8eb559c6448b0c466bf600ffffffff64000000000000000034fbb7fa4a8c81f9d7dd0d03b88ee36fb8a40778436448462b9bda7753572ac300ffffffff64000000',
'00000000007de0f6044641a8e8d9891da4113a7cd2085a2d5023d324bab4dfb5d12f68181a00ffffffff640000000000000000e0d68fe4c5ca5db5f003aa3e090e1e01222709b163f0edc9',
'62729811678fd69200ffffffff6400000000000000003064db53f65154fe52eca8739c8dc66b06015688a50098ff9e46d1cf5328633600ffffffff640000000000000000cac96d1c33206d',
'28e25acbdd8da9228311cbbbec0c85be4ae37c2a90043466f800ffffffff640000000000000000f2da65999470dcf27b7bc5bcea8786ddd6a4927aefc038d9e2a2045d4d1a98f600ffffff',
'ff640000000000000000f960c34a037e7e4fb8d91ebe47ab0807279b6b27d7cc5de5350a94fc93e951f300ffffffff6400000000000000008f6847ce834610c216e70904b85ded1bb976c6',
'4afaa30810a3e4ca1cdc9ffae200ffffffff640000000000000000542b1ea5a305b2a54ea3478577335c47768756d8dda9fcb70ae7e35a2b9ac20500ffffffff64000000000000000017aa',
'843d36638a5fca47bf146519ba508e682effbf91af2e285b3eca6749db1b00ffffffff64000000000000000099f5a084b6b1dca6f35354f56d8beec0aea403e1646453d23ce12e0ce70dce',
'2100ffffffff64000000000000000085edc4bd80944ef6d2e46d19f99beb6aef1af1d4dab10c88d4be4bdfa545220500ffffffff640000000000000000decfb9b9f44df93b097f94d90307',
'39ca9d1b208ccd9c0a2a845688c00a6168a600ffffffff640000000000000000124f1d88ba20a5e8e74ad41ae56f087036825a32c8896e7fe1518daf24a84d0400ffffffff640000000000',
'000000cfabaff131e5db99269784f17b9e9f55395e558831548315630746dcfa186d4c00ffffffff6400000000000000000218b06e1c55ad68b3087887680126cddb503a34400e72eda4f2',
'ebcd5899f65f00ffffffff6400000000000000004a92c441189b1d99450791f9193d14c80bfcba80bb6184f2af6ac4f14b85dbcf00ffffffff6400000000000000001d5fc3578c5ba8bcd5',
'75106f21828037d7cf7329e3b2d24dcc24239d4673af5500ffffffff6400000000000000008d9f106268c919ff4d2e0bf9250e3ae79e8d308b6991ebbbac77f172953677ea00ffffffff64',
'0000000000000000e3075f63746774218afa23d0b24451a3808769ce329b79dad5fcaa38ffbf2e0700ffffffff640000000000000000475a65359145e3bc9924b32f92c1d7fbcead921fd2',
'3b19da8d79dd558cc882d900ffffffff6400000000000000005d73d9749f8dffa83bd43c73a17cee6c3c87044c94934526f306ee447761ec1600ffffffff64000000000000000030238214',
'7f48cf779529a84ed8f14043f02a845977608a28d8504c4b494c1df500ffffffff640000000000000000fe2bd4f007f9ffe216a88c0e0b53c883e2764a4fb200526d478fddcb55cd3a0f00',
'ffffffff640000000000000000ac267e42b9aeefac5d9f83d750e800bd67c02c5da2175a177decb7cefba08de000ffffffff6400000000000000005f05c3ae4ae13f80f16aacfd19108f92',
'945e1595241e30ecba950f7beb99032b00ffffffff640000000000000000b2695da8e631266b354c30134772087547fc7ecd8ec27b9edf3d06e0e6dc6f9700ffffffff6400000000000000',
'007d5d3a8baf787d42aadb00b18acbe1e52393e07922129153bd42e6a3f1abf11200ffffffff640000000000000000ffba0e8c33eeb1dba8c5d850443eba299bef5abe0644ccd24752bba2',
'd7c7418000ffffffff64000000000000000018b2932dc1a15531a124d5bda0bf83e0464f1ce97c5b74c66e5540daac80856d00ffffffff6400000000000000006df53d4f133caffd2f10b9',
'7a696dc56b898a3c181314fd6026f3f2c7c5b93b4900ffffffff6400000000000000009762ccac9454dde3dba370be278878e7529bdcea45c4eadcc03fd745c56f1ff900ffffffff640000',
'000000000000e9335fc9f7c5e0c2c93a6fd49a8bbfec23706bb952e85818b560d41f46b6a51800ffffffff6400000000000000008f8f9397249fe8a822ed0d652fcc85aeb88eb13f50a29c',
'436c390b76a9dc40d900ffffffff6400000000000000008fe955ae92aaf24eb98825acb1d9036c28dc8b6f6131c012c6efe7f4c974a04800ffffffff640000000000000000e66ad3673a4e',
'de4e975ab8f2306f94fe1565f5bf844096f04e392d781dee6c6500ffffffff640000000000000000df3ca73797189485654fb80e5c7dd307cef75e8fef008d28317d36172b613b7900ffff',
'ffff640000000000000000606881860a62dd163a778dc1931e408ccfb1d8f85ec76db2a4d058abab65e0e800ffffffff640000000000000000124b3fac2fea22ce5638660b9c31ad08e7d2',
'9f94547e2a8a38d830f4a60bb58e00ffffffff640000000000000000d1393d36261e95c062c8b1411c89148411faed88a11aab30c28a5f5a2db71b6700ffffffff64000000000000000068',
'6a749aba4b8b3d614597192dbaffd478763e28b7256ec2651c1a0d0094ff6d00ffffffff640000000000000000297ce57fc35a47130ec9a73facec49e2c05220073179daada1452236ec8f',
'26b800ffffffff64000000000000000012bc86dbba8b482cc8f55b47a8c4b186a2862736e5655b33a4549ec14904901e00ffffffff640000000000000000f9a81787718371b4e43ae35023',
'76f1ab00aa6ef836be5c2035d26bfae721573800ffffffff64000000000000000001f7031a6c0267e96501f91e8d7f2f371617c6fbe6a25403a6f83bf998b454b900ffffffff6400000000',
'000000003a432cfbb56a16bcdb9e0fca921fdf37417e7778bd1a61e71097443ed23e91bc00ffffffff640000000000000000c06fa6743d6872f13c4d3915a7f3dc50efe98ea03fb475bfa6',
'745ac5b2fa9d6300ffffffff6400000000000000002f7bd988b7d40e763bde7607966225167cb864211da0497aa8d4793ab7d8734700ffffffff64000000000000000093b9aff81e863b51',
'04a6447ee511334dbbf539b82c0b8d5e393b109a5a923b6c00ffffffff640000000000000000f6685e5950de0be5f7c3e47e2f6639a4a60686153191a358b13809857a47721a00ffffffff',
'6400000000000000008e23b60379434ff482c4ae4f4c80ea8be451216becc50e13762c26bccbba8d3b00ffffffff6400000000000000000991f0a886d0e88df43141e0454fde34f8f25a0a',
'2363cfb8c47b97d632026adf00ffffffff6400000000000000008f5aabc681fa0e949a4c9a4824ab7fc4bcf5c12058c6cfc80b4dbebde38b23cc00ffffffff640000000000000000e203eb',
'7a079e1ce720c47544ac07c58a948f76602bac718e3255e71ba867a46100ffffffff640000000000000000a84581ed2e6aae8ab1a1a3fc8c696d8f366325b181c4265a220910b2e107d214',
'00ffffffff6400000000000000003ba9f6cb144a51cc26fe9f8167752e8b16084a9640ef85d64acdd71c3f4d6cae00ffffffff640000000000000000ea759c74c2ef617141b66073d544f6',
'b64fd9713e619f0843ff45e976cbb62b1900ffffffff640000000000000000ef7f6e7923cbeb19c36ac5dd508c093b6b86395b79b69d102567955c761223de00ffffffff64000000000000',
'0000f3f52afb8c5dcc2b180329237e18abdd248b2d9ca9e5d2db7c097cbab1f5eddc00ffffffff640000000000000000f2f04de6b35bd73948d7f8be960366de3a54971982acafe5a955be',
'4a789bd2bd00ffffffff6400000000000000006bc059bb0c568266097b0243a02902dd3cf01820fab23d631c2c5ea61d29386900ffffffff6400000000000000002b4bd9a0d88d47eaeebe',
'6021b68b29eba36dc0c69523999b8f7cf10e482647b200ffffffff640000000000000000cd30c8085abbbfbb40130a9f1b19fff13c7ca1653cb628e6311619100dd3151a00ffffffff6400',
'000000000000003a699419da43dfbd3614c69ba52b4e9c732c9d5903cb0f83f57240592a6936f500ffffffff640000000000000000eb9ced278fda86934b6e3173efdd7f50dd35482b782b',
'04707de987ad4e866edd00ffffffff640000000000000000c93f0b1645289654c0e2e93ed604bc6384e9a3d661469bb0a537b74d1829a30700ffffffff640000000000000000bc958c4376',
'81bee10f25b30c0f61d933bc022091a2f9301cd500b6a93ca6d0a900ffffffff640000000000000000f05fb5b89b719333ec02b5505e619d25c6f731b5d2c6833ae0e48ba4e1d04fec00ff',
'ffffff64000000000000000043b65f2536cc3aef8e7313a6f081eb685605fde8644f2f3c6a2cc7902acddbaa00ffffffff640000000000000000093c7251f1088e489829d12d8d996d0518',
'7521ef13eda4fad391bddaeb76629a00ffffffff640000000000000000f33ba8e0a69497ccf2f38e94920d96417456ff577b41756b423da7beaafd4d8800ffffffff640000000000000000',
'66a26b58d611e7c537c36d3e3def4703f50a88e296344a2a466d83b8514dc7dc00ffffffff640000000000000000822795d037093d67b8134537bc3d6df0499c7b44638c2925be561eea4d',
'07a47800ffffffff640000000000000000ca728720f6dbad8487d0a859868d072f3c24763856722de521b0371330b4cd7200ffffffff6400000000000000004b6f4dda6fce70c73c6ce74e',
'73bc1fb167c53eec2f02e1d67e3ffae4b933cfcc00ffffffff640000000000000000c582dda4dd55cde0d8e5c4d2ef39ceb74d5f2738f85aa0af2b78dd6b23feedb500ffffffff64000000',
'00000000008247f73edb4b269f30e7618eb2448314fd0b1e7a39c421882a8c5c914ad995fb00ffffffff640000000000000000660ae2a8dbd959710ee03ff9a81efa6e758fa82bd90ba917',
'8713bdf35d3fb6db00ffffffff640000000000000000404f0244516c869733583cd1e19f84313522d62fd507bb9789dc9a166836503c00ffffffff640000000000000000ff3215da8a7bd4',
'16c42fac284bb23990d15971420e4c3ceda811b1c2ec3b5e5d00ffffffff640000000000000000dd2d4a48200e3f02cbc9e42143840ff43eabe40dfdb634019be8acb93ce64fc100ffffff',
'ff64000000000000000085fde84bb5b88855f0462fe1544a125ba321a56c92db4edac740ed92c33c4b9200ffffffff6400000000000000004ab049d55c22574cd416bad7d5367f1679ef9e',
'aadd9b293f75a95a326096dc2200ffffffff6400000000000000001c533dcc22d652dc9b99f113a7bee20ac50dbdcf96e3747c5de55acff31c134500ffffffff64000000000000000062cb',
'3bdf715e4f1047caf34e24f3197acb4a539d2c60431110d1e4ecd980e4fa00ffffffff64000000000000000063052329c15ac065df1bd39b393c0decdb47285e22832c4c71b2e657d620c7',
'1f00ffffffff64000000000000000056a07cceebf98268ead2646778c79d7c9348fc36f1c4852b87a50adb62e7d79000ffffffff6400000000000000008f54513e722f3dd601b80c6e12e8',
'0722f012b6be11f3b8691d51cb085398568d00ffffffff64000000000000000030e72170e37dcb2bd380c75f4e2be7dbea894ec862ab87c3cbb78712a4efca4500ffffffff640000000000',
'0000000add6dac988247abe762cdffd72c2d1c0284b9f5d35affde5b2b43b7c6cbba1800ffffffff640000000000000000d52d7619e84d01e6854be84f860c63e93bb562fbf31a34ce36e9',
'd0960c541fbc00ffffffff640000000000000000cc77bad78978af08199eec272240b7a523053722518294233b03df477efe190d00ffffffff64000000000000000089285138176fbfcd46',
'0d3572d857dd4c8ffef9ad3a052cd8da235a38f65d706600ffffffff6400000000000000001e38b54658ce8da1dcb4b5e5bfedd2bcad3d68526680f34700c7ad47130803bc00ffffffff64',
'00000000000000006591a90dbb9e79f48d45e5221f7e843e6360d4b95129702ed6aa636fb359f7b300ffffffff640000000000000000f23c6cc2a79c20a8d897e683d574d23793f577ae00',
'655f0d2e90c8c8bdd8372700ffffffff640000000000000000c29ed64d215acac76b7b0394ee5988f6844b2591e39978b6a7c930c409791e7000ffffffff640000000000000000b5b25ac4',
'60891d61cbe5f14be50d3c6196b0fdb5f210f28f09d3600bc88f2b4a00ffffffff64000000000000000080bc6161e5b7da3634ad23b8733f9cf5d1356501ad673f503680e8343d42e3aa00',
'ffffffff6400000000000000009ea2c0bd30f14d73f7e72d5c613d8c2b50bc6264bfa6bb8cc5cec0c2356357a400ffffffff640000000000000000dc8c68bf5ca649e6d09a5fbaf930df73',
'71a06bf2755a9e272b9134feba8b253c00ffffffff64000000000000000092920ed6d1de8c9f54743ba6596fbecc3868ab72e659ce0830020e7dadcbb86000ffffffff6400000000000000',
'00ec80b0d295889981724933a179725fa1562351f564cf522a2c7355b48655c5f800ffffffff64000000000000000098a03d4cdf3a2c347b00667c7e01ccf2b08310c4f4a1726dd276d462',
'f70130e600ffffffff6400000000000000004387a6b91f33e461b4efbada8e34bb7177e9b29e5fdc6800a13c99f7c2ecb37000ffffffff640000000000000000e3faebd80fc0c74be536cc',
'5edc7a2eee0ac2e58147adb06ad5d9ff13b4df91b500ffffffff6400000000000000005ba44840d5eeb4ebddbe19a6b3d0537f91691e3b6703f650d02e3fd8d46e1b4c00ffffffff640000',
'0000000000fd000100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100',
'010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001',
'510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000',
'000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000',
'000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000',
'000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001',
'000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151',
'000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000',
'015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000',
'000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000',
'000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100',
'000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100',
'010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001',
'510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000',
'000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000',
'000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000',
'000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001',
'000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151',
'000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000',
'015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000',
'000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000',
'000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100',
'000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100',
'010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001',
'510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000',
'000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000',
'000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000',
'000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001',
'000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151',
'000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000',
'015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000',
'000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000',
'000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100',
'000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100',
'010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001',
'510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000',
'000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100010000000000000001510001000000000000000151000100000000',
'0000000151000100000000000000015100010000000000000001510001000000000000000151000100000000000000015100000000'
            ])

        testtx = CTransaction(t)
        assert(testtx.toHex() == t)
        assert(uint256ToRpcHex(testtx.GetIdem()) == "f81ab4c3baf880c2708e05270c74fc3e1abd9aabdb32041a2d57a3ee6d67197b")
        assert(uint256ToRpcHex(testtx.GetId()) == "503071de7531264e7c53344392decf5c0cdebd59c3778b4fbde8d3d7d8fa2a6d")

        blkhash = self.nodes[0].generate(1)[0]
        blkjson = self.nodes[0].getblock(blkhash)
        blkhex  = self.nodes[0].getblock(blkhash, False)
        blk = CBlock(blkhex)

        assert(blk.nTime == blkjson["time"])
        assert(ser_uint256(blk.hashMerkleRoot)[::-1].hex() == blkjson["merkleroot"])
        for i in range(len(blk.vtx)):
            t = blk.vtx[i]
            tid = t.GetId()
            tidem = t.GetIdem()
            assert (blkjson["txid"][i] == uint256ToRpcHex(tid))
            assert (blkjson["txidem"][i] == uint256ToRpcHex(tidem))

        assert(uint256ToRpcHex(blk.hashMerkleRoot) == blkjson["merkleroot"])
        assert(blk.hashMerkleRoot == blk.calc_merkle_root())

        unspent = self.nodes[0].listunspent()
        for u in unspent:
            #print(u['outpoint'])
            outpt = COutPoint()
            outpt.fromIdemAndIdx(u['txidem'],u['vout'])
            # print(uint256ToRpcHex(outpt.hash))
            assert(uint256ToRpcHex(outpt.hash) == u['outpoint'])

        # Now try block with a few tx
        addr = self.nodes[0].getnewaddress()
        for i in range(1,20):
            vtx = {}
            for j in range(0,i):
                txhash = self.nodes[0].sendtoaddress(addr,1000000)
                txjson = self.nodes[0].gettransaction(txhash)
                tx = CTransaction()
                tx.deserialize(txjson["hex"])
                assert(txjson["txidem"] == uint256ToRpcHex(tx.GetIdem()))
                assert(txjson["txid"] == uint256ToRpcHex(tx.GetId()))
                vtx[tx] = txjson

            blkhash = self.nodes[0].generate(1)[0]
            blkjson = self.nodes[0].getblock(blkhash)
            blkhex  = self.nodes[0].getblock(blkhash, False)
            blk = CBlock(blkhex)

            assert(len(blkjson["txid"]) == i+1) # +1 for coinbase
            for j in range(len(blk.vtx)):
                t = blk.vtx[j]
                tid = t.GetId()
                tidem = t.GetIdem()
                assert (blkjson["txid"][j] == uint256ToRpcHex(tid))
                assert (blkjson["txidem"][j] == uint256ToRpcHex(tidem))

            assert(uint256ToRpcHex(blk.hashMerkleRoot) == blkjson["merkleroot"])
            assert(blk.hashMerkleRoot == blk.calc_merkle_root())




if __name__ == '__main__':
    MyTest ().main ()

# Create a convenient function for an interactive python debugging session
def Test():
    t = MyTest()
    t.drop_to_pdb = True
    bitcoinConf = {
        "debug": ["net", "blk", "thin", "mempool", "req", "bench", "evict"],
    }
    flags = standardFlags()
    # flags[0]='--tmpdir=/ramdisk/test/t1'
    t.main(flags, bitcoinConf, None)
